# 浏览器直接打印功能说明

## 功能概述

我们已经为系统添加了**浏览器直接打印**功能，现在您可以直接通过浏览器的打印对话框打印标签，无需下载ZPL文件或安装额外软件。

## 新增功能

### 1. 单个标签浏览器打印

在打印预览对话框中，您现在可以看到两个按钮：
- **下载ZPL**：下载ZPL文件（原有功能）
- **浏览器打印**：直接打开浏览器打印对话框（新功能）⭐

### 2. 批量标签浏览器打印

点击"批量打印"按钮后，会弹出新的对话框，提供两种打印方式：
- **下载ZPL**：下载包含所有标签的ZPL文件
- **浏览器打印**：直接打印所有选中的标签（新功能）⭐

## 使用方法

### 单个标签打印

1. 点击数据行的打印图标
2. 在打印预览对话框中查看标签效果
3. 点击"浏览器打印"按钮
4. 在浏览器打印对话框中：
   - 选择打印机
   - 设置纸张尺寸为 80mm × 60mm
   - 边距设置为"无"
   - 点击"打印"

### 批量标签打印

1. 勾选需要打印的多条数据
2. 点击"批量打印"按钮
3. 在弹出的对话框中点击"浏览器打印"
4. 在浏览器打印对话框中：
   - 选择打印机
   - 设置纸张尺寸为 80mm × 60mm
   - 边距设置为"无"
   - 点击"打印"

## 技术实现

### 核心技术

- **react-to-print**：React打印库，用于触发浏览器打印功能
- **PrintableLabel组件**：专门设计的可打印标签组件
- **CSS @media print**：打印样式优化

### 标签样式

打印标签使用HTML/CSS实现，完全匹配ZPL标签的布局：

```
┌─────────────────────────────────────────────────┐
│                                                 │
│  料桶码      285A210115              ┌─────┐   │
│                                      │     │   │
│  料品批次    2024030601              │ QR  │   │
│                                      │Code │   │
│  托盘码      285A210115-18           │     │   │
│                                      │     │   │
│  料品编码    300100-00204            └─────┘   │
│                                                 │
│  料品名称    石英砂                             │
│                                                 │
│  规格型号    HV-8-SBH                          │
│                                                 │
│            圣宝鸿料桶标签                       │
└─────────────────────────────────────────────────┘
```

### 打印样式优化

```css
@media print {
  @page {
    size: 80mm 60mm;
    margin: 0;
  }
  
  .print-label {
    width: 80mm;
    height: 60mm;
    page-break-after: always;
  }
}
```

## 两种打印方式对比

### 浏览器打印 vs ZPL文件

| 特性 | 浏览器打印 | ZPL文件 |
|------|-----------|---------|
| **易用性** | ⭐⭐⭐⭐⭐ 非常简单 | ⭐⭐⭐ 需要额外工具 |
| **打印机兼容性** | ⭐⭐⭐⭐⭐ 支持所有打印机 | ⭐⭐⭐ 仅斑马打印机 |
| **打印质量** | ⭐⭐⭐⭐ 取决于打印机 | ⭐⭐⭐⭐⭐ 专业标签质量 |
| **安装要求** | ⭐⭐⭐⭐⭐ 无需安装 | ⭐⭐ 需要专业工具 |
| **批量打印** | ⭐⭐⭐⭐ 支持 | ⭐⭐⭐⭐⭐ 更适合大批量 |
| **自动化** | ⭐⭐ 需要手动操作 | ⭐⭐⭐⭐⭐ 可完全自动化 |

### 推荐使用场景

**使用浏览器打印：**
- ✅ 使用普通打印机（激光、喷墨等）
- ✅ 临时打印少量标签
- ✅ 不熟悉ZPL命令
- ✅ 快速测试打印效果
- ✅ 办公环境打印

**使用ZPL文件：**
- ✅ 使用斑马标签打印机
- ✅ 需要专业标签质量
- ✅ 批量自动化打印
- ✅ 生产环境使用
- ✅ 需要精确控制打印参数

## 浏览器打印设置指南

### Chrome浏览器

1. 点击"浏览器打印"后，打开打印对话框
2. 目标打印机：选择您的打印机
3. 更多设置：
   - 纸张尺寸：自定义 → 80 x 60 mm
   - 边距：无
   - 缩放：100%
   - 选项：取消勾选"页眉和页脚"
4. 点击"打印"

### Edge浏览器

1. 点击"浏览器打印"后，打开打印对话框
2. 打印机：选择您的打印机
3. 更多设置：
   - 纸张尺寸：自定义 → 宽度80mm，高度60mm
   - 边距：无
   - 缩放：实际大小
4. 点击"打印"

### Firefox浏览器

1. 点击"浏览器打印"后，打开打印对话框
2. 打印机：选择您的打印机
3. 页面设置：
   - 纸张尺寸：自定义 → 80mm x 60mm
   - 边距：0
4. 点击"打印"

## 常见问题

### Q1: 浏览器打印和ZPL打印有什么区别？

A: 
- **浏览器打印**：使用HTML/CSS渲染标签，通过浏览器的打印功能输出，适合普通打印机
- **ZPL打印**：使用ZPL命令直接控制打印机，专为斑马标签打印机优化，打印质量更高

### Q2: 为什么浏览器打印的标签和预览不一样？

A: 可能是打印机设置问题：
1. 检查纸张尺寸是否设置为80mm × 60mm
2. 确保边距设置为"无"
3. 缩放比例设置为100%或"实际大小"
4. 取消勾选"页眉和页脚"

### Q3: 批量打印时标签会分页吗？

A: 会的。每个标签会自动分页打印，确保每个标签都在独立的纸张上。

### Q4: 可以保存打印设置吗？

A: 大多数浏览器会记住您的打印设置。首次设置后，后续打印会自动使用相同的设置。

### Q5: 浏览器打印支持哪些打印机？

A: 支持所有通过浏览器可访问的打印机，包括：
- 本地USB打印机
- 网络打印机
- 共享打印机
- PDF打印机（可以保存为PDF）

### Q6: 如何调整标签的字体大小？

A: 浏览器打印的标签样式是固定的。如果需要调整，可以：
1. 使用浏览器的缩放功能（不推荐，可能影响布局）
2. 联系技术人员修改PrintableLabel组件的样式
3. 使用ZPL方式，在ZPL代码中调整字体大小

### Q7: 可以打印到PDF吗？

A: 可以！在打印对话框中选择"另存为PDF"或"Microsoft Print to PDF"，就可以将标签保存为PDF文件。

## 技术细节

### 组件结构

```
PrintPreviewDialog (打印预览对话框)
├── 标签预览 (可视化展示)
├── ZPL代码 (代码查看)
└── 操作按钮
    ├── 下载ZPL
    └── 浏览器打印 ⭐

BatchPrintDialog (批量打印对话框)
├── 打印方式说明
└── 操作按钮
    ├── 下载ZPL
    └── 浏览器打印 ⭐

PrintableLabel (可打印标签组件)
├── 标签内容 (HTML/CSS)
├── 二维码 (QRCodeDataUrl组件)
└── 打印样式 (@media print)
```

### 关键代码

**PrintableLabel组件**：
```tsx
export const PrintableLabel = forwardRef<HTMLDivElement, PrintableLabelProps>(
  ({ material }, ref) => {
    return (
      <div ref={ref} className="print-label">
        <style>{`
          @media print {
            @page {
              size: 80mm 60mm;
              margin: 0;
            }
          }
        `}</style>
        {/* 标签内容 */}
      </div>
    );
  }
);
```

**打印触发**：
```tsx
const handlePrint = useReactToPrint({
  contentRef: printRef,
  documentTitle: `标签_${material?.material_code}`,
  onAfterPrint: () => {
    toast.success("打印任务已发送");
  },
});
```

## 更新日志

### v1.1.0 (2025-01-06)

**新增功能：**
- ✅ 单个标签浏览器打印
- ✅ 批量标签浏览器打印
- ✅ PrintableLabel可打印标签组件
- ✅ BatchPrintDialog批量打印对话框
- ✅ 打印方式选择说明

**优化改进：**
- ✅ 打印预览对话框按钮文字更新
- ✅ 批量打印按钮文字从"批量下载ZPL"改为"批量打印"
- ✅ 添加打印方式对比说明
- ✅ 更新用户指南文档

**技术升级：**
- ✅ 集成react-to-print库
- ✅ 优化打印样式CSS
- ✅ 支持批量标签分页打印

## 总结

浏览器直接打印功能的添加，让系统更加易用和灵活：

1. **降低使用门槛**：无需安装额外软件，任何人都可以轻松打印
2. **提高灵活性**：支持任何类型的打印机，不局限于斑马打印机
3. **保留专业功能**：ZPL打印方式依然保留，满足专业用户需求
4. **用户体验优化**：清晰的打印方式说明，帮助用户选择最适合的方案

现在，您可以根据实际情况选择最合适的打印方式，享受更便捷的打印体验！
